<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>B1 ë³´ë“œê²Œì„ì¹´í˜ ë¶€í‰êµ¬ì²­ì  ë§ˆì‘ ìˆœìœ„</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 10px;
            padding: 0;
            background: #ffffff;
            color: #000;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
        }

        /* ìƒë‹¨ ìƒˆë¡œê³ ì¹¨ í‘œì‹œ */
        #refresh-timer {
            position: fixed;
            top: 8px;
            right: 12px;
            font-size: 12px;
            opacity: 0.8;
        }

        /* ê³µí†µ í…Œì´ë¸” */
        table {
            border-collapse: collapse;
            width: 100%;
        }

        thead th {
            background-color: #f0f0f0;
            font-weight: bold;
            padding: 8px;
            border: 1px solid #ccc;
            text-align: center;
        }

        tbody td {
            border: 1px solid #ccc;
            padding: 6px;
            text-align: center;
        }

        tbody tr:nth-child(even) {
            background-color: #fafafa;
        }

        /* ìƒë‹¨ 2ë¶„í•  ì˜ì—­ */
        .top-section {
            display: flex;
            gap: 12px;
            margin: 10px 0 20px;
        }

        .left-box,
        .right-box {
            flex: 1;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 6px;
        }

        .right-box {
            text-align: center;
        }

        .right-box img {
            max-width: 100%;
            height: auto;
            margin-top: 8px;
        }

        /* ë©”ì¸ í…Œì´ë¸” ì—¬ë°± ì¤„ì´ê¸° */
        .main-table-wrapper {
            margin: 0 4px;
        }

        /* ë‹¤í¬ëª¨ë“œ */
        @media (prefers-color-scheme: dark) {
            body {
                background: #121212;
                color: #e0e0e0;
            }

            thead th {
                background-color: #2a2a2a;
                border-color: #444;
            }

            tbody td {
                border-color: #444;
            }

            tbody tr:nth-child(even) {
                background-color: #1e1e1e;
            }

            .left-box,
            .right-box {
                border-color: #444;
            }
        }
    </style>
</head>
<body>

<div id="refresh-timer"></div>

<h1>B1 ë§ˆì‘ ìˆœìœ„</h1>

<!-- ìƒë‹¨ 2ë¶„í•  ì˜ì—­ -->
<div class="top-section">
    <!-- ì™¼ìª½: ì‘ì€ í…Œì´ë¸” -->
    <div class="left-box">
        <table id="small-table">
            <thead>
                <tr id="small-header"></tr>
            </thead>
            <tbody id="small-body"></tbody>
        </table>
    </div>

    <!-- ì˜¤ë¥¸ìª½: QR -->
    <div class="right-box">
        <div><strong>ë§ˆì‘ ì ìˆ˜ ì…ë ¥ QR</strong></div>
        <img src="images/input.png" alt="ë§ˆì‘ ì ìˆ˜ ì…ë ¥ QR">
    </div>
</div>

<!-- ë©”ì¸ í…Œì´ë¸” -->
<div class="main-table-wrapper">
    <table id="main-table">
        <thead>
            <tr id="main-header"></tr>
        </thead>
        <tbody id="main-body"></tbody>
    </table>
</div>

<script>
/* =====================================================
   ğŸ”§ ìˆ˜ì •í•˜ê¸° ì‰¬ìš´ ì„¤ì • ì˜ì—­
===================================================== */

// ë©”ì¸ í…Œì´ë¸”: ë‘ ë²ˆì§¸ ì—´ í•„í„° ê¸°ì¤€
const MIN_SECOND_COLUMN_VALUE = 2;

// ìë™ ìƒˆë¡œê³ ì¹¨ ì‹œê°„ (ì´ˆ)
const REFRESH_SECONDS = 600;


/* =====================================================
   Google Spreadsheet ì •ë³´
===================================================== */
const SHEET_ID = "116rMCpgeAwOhMx5HNJk6vH16WJxvDPoNclyIQAc8pzs";

// ë©”ì¸ ë­í‚¹ ì‹œíŠ¸
const MAIN_GID = "1729121045";

// ì‘ì€ í‘œ ì‹œíŠ¸
const SMALL_GID = "801258754";


/* =====================================================
   ìë™ ìƒˆë¡œê³ ì¹¨ ì¹´ìš´íŠ¸ë‹¤ìš´
===================================================== */
let remaining = REFRESH_SECONDS;
const timerEl = document.getElementById("refresh-timer");

setInterval(() => {
    remaining--;
    timerEl.textContent = `${remaining} ì´ˆ í›„ ìƒˆë¡œê³ ì¹¨`;

    if (remaining <= 0) {
        location.reload();
    }
}, 1000);


/* =====================================================
   ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜
===================================================== */
function fetchSheet(gid) {
    const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?gid=${gid}&tqx=out:json`;
    return fetch(url)
        .then(res => res.text())
        .then(text => JSON.parse(text.substring(47, text.length - 2)));
}


/* =====================================================
   ì‘ì€ í‘œ (ê·¸ëŒ€ë¡œ ì¶œë ¥)
===================================================== */
fetchSheet(SMALL_GID).then(json => {
    const cols = json.table.cols;
    const rows = json.table.rows;

    const header = document.getElementById("small-header");
    const body = document.getElementById("small-body");

    cols.forEach(c => {
        const th = document.createElement("th");
        th.textContent = c.label || "";
        header.appendChild(th);
    });

    rows.forEach(r => {
        const tr = document.createElement("tr");
        r.c.forEach(cell => {
            const td = document.createElement("td");
            td.textContent = cell ? cell.v : "";
            tr.appendChild(td);
        });
        body.appendChild(tr);
    });
});


/* =====================================================
   ë©”ì¸ ë­í‚¹ í…Œì´ë¸”
===================================================== */
fetchSheet(MAIN_GID).then(json => {
    const cols = json.table.cols;
    const rows = json.table.rows;

    const header = document.getElementById("main-header");
    const body = document.getElementById("main-body");

    // í—¤ë”
    const rankTh = document.createElement("th");
    rankTh.textContent = "ìˆœìœ„";
    header.appendChild(rankTh);

    for (let i = 0; i < 3; i++) {
        const th = document.createElement("th");
        th.textContent = cols[i].label || "";
        header.appendChild(th);
    }

    // ë°ì´í„° ê°€ê³µ
    const data = rows
        .map(r => r.c.map(c => (c ? c.v : "")))
        .filter(r => Number(r[1]) >= MIN_SECOND_COLUMN_VALUE)
        .sort((a, b) => Number(b[2]) - Number(a[2]));

    data.forEach((row, index) => {
        const tr = document.createElement("tr");

        const rankTd = document.createElement("td");
        rankTd.textContent = index + 1;
        tr.appendChild(rankTd);

        for (let i = 0; i < 3; i++) {
            const td = document.createElement("td");
            td.textContent = row[i];
            tr.appendChild(td);
        }

        body.appendChild(tr);
    });
});
</script>

</body>
</html>
