<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>Google Spreadsheet Table</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
        }

        table {
            border-collapse: collapse;
            width: 100%;
        }

        thead th {
            background-color: #f2f2f2;
            font-weight: bold;
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }

        tbody td {
            border: 1px solid #ccc;
            padding: 8px;
            text-align: center;
        }

        tbody tr:nth-child(even) {
            background-color: #fafafa;
        }
    </style>
</head>
<body>

<h2>êµ¬ê¸€ ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ë°ì´í„° ì¶œë ¥</h2>

<table id="data-table">
    <thead>
        <tr id="header-row"></tr>
    </thead>
    <tbody id="table-body"></tbody>
</table>

<script>
/* =====================================================
   ğŸ”§ ì‚¬ìš©ìê°€ ë‚˜ì¤‘ì— ì‰½ê²Œ ìˆ˜ì •í•  ìˆ˜ ìˆëŠ” ì„¤ì • ì˜ì—­
===================================================== */

// ë‘ ë²ˆì§¸ ì—´ ê°’ì´ ì´ ìˆ«ì ì´ìƒì¼ ë•Œë§Œ ì¶œë ¥
const MIN_SECOND_COLUMN_VALUE = 2;


/* =====================================================
   Google Spreadsheet ì •ë³´
===================================================== */
const SHEET_ID = "116rMCpgeAwOhMx5HNJk6vH16WJxvDPoNclyIQAc8pzs";
const GID = "1729121045";

// Google Visualization API (gid ì‚¬ìš© ê°€ëŠ¥)
const QUERY_URL =
    `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?gid=${GID}&tqx=out:json`;


/* =====================================================
   ë°ì´í„° ë¡œë”©
===================================================== */
fetch(QUERY_URL)
    .then(res => res.text())
    .then(text => {
        // Google Visualization JSON íŒŒì‹±
        const json = JSON.parse(text.substring(47, text.length - 2));

        const cols = json.table.cols;
        const rows = json.table.rows;

        // ===== í—¤ë” ìƒì„± =====
        const headerRow = document.getElementById("header-row");

        // ì²« ë²ˆì§¸ ì—´: ìˆœìœ„
        const rankTh = document.createElement("th");
        rankTh.textContent = "ìˆœìœ„";
        headerRow.appendChild(rankTh);

        // ì‹œíŠ¸ì˜ ì• 3ê°œ ì—´ë§Œ ì‚¬ìš©í•´ì„œ ì´ 4ì—´ êµ¬ì„±
        for (let i = 0; i < 3; i++) {
            const th = document.createElement("th");
            th.textContent = cols[i].label || `ì»¬ëŸ¼ ${i + 1}`;
            headerRow.appendChild(th);
        }

        // ===== ë°ì´í„° ê°€ê³µ =====
        let dataRows = rows
            .map(r => r.c.map(c => (c ? c.v : "")))
            // ë‘ ë²ˆì§¸ ì—´ ê°’ í•„í„°ë§
            .filter(r => Number(r[1]) >= MIN_SECOND_COLUMN_VALUE)
            // ì„¸ ë²ˆì§¸ ì—´ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
            .sort((a, b) => Number(b[2]) - Number(a[2]));

        // ===== í…Œì´ë¸” ì¶œë ¥ =====
        const tbody = document.getElementById("table-body");

        dataRows.forEach((row, index) => {
            const tr = document.createElement("tr");

            // ìˆœìœ„
            const rankTd = document.createElement("td");
            rankTd.textContent = index + 1;
            tr.appendChild(rankTd);

            // ì•ì˜ 3ê°œ ì»¬ëŸ¼ë§Œ ì¶œë ¥
            for (let i = 0; i < 3; i++) {
                const td = document.createElement("td");
                td.textContent = row[i];
                tr.appendChild(td);
            }

            tbody.appendChild(tr);
        });
    })
    .catch(err => {
        console.error(err);
        alert("ìŠ¤í”„ë ˆë“œì‹œíŠ¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
    });
</script>

</body>
</html>
